<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>MP SHOP POS PRO MAX</title>

<style>

body{
font-family:Arial;
background:#f4f6f8;
margin:0;
}

.header{
background:#2c3e50;
color:white;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

.container{
display:grid;
grid-template-columns:1fr 1fr;
gap:15px;
padding:15px;
}

.card{
background:white;
padding:15px;
border-radius:8px;
box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

button{
background:#3498db;
color:white;
border:none;
padding:10px;
width:100%;
margin-top:5px;
cursor:pointer;
}

button:hover{
background:#2980b9;
}

input{
width:100%;
padding:8px;
margin-top:5px;
}

.hidden{
display:none;
}

.product{
background:#ecf0f1;
padding:8px;
margin-top:5px;
cursor:pointer;
}

.product:hover{
background:#d0d7de;
}

.qrBox{
text-align:center;
}

.qrBox img{
width:200px;
}

.payTotal{
font-size:22px;
margin:10px;
font-weight:bold;
}

.login{
max-width:300px;
margin:100px auto;
background:white;
padding:20px;
border-radius:8px;
}

</style>

</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="login">

<h3>เข้าสู่ระบบ</h3>

<select id="role">

<option value="cashier">Cashier</option>
<option value="admin">Admin</option>

</select>

<input id="password" type="password" placeholder="รหัสผ่าน">

<button onclick="login()">เข้าสู่ระบบ</button>

</div>


<!-- MAIN SYSTEM -->
<div id="mainPage" class="hidden">

<div class="header">

<div>MP SHOP POS PRO MAX</div>

<div>
<span id="userLabel"></span>
<button onclick="logout()">Logout</button>
</div>

</div>


<div class="container">

<!-- PRODUCTS -->
<div class="card">

<h3>ค้นหา</h3>

<input id="search" placeholder="ค้นหา..." onkeyup="renderProducts()">

<div id="productList"></div>

</div>


<!-- CART -->
<div class="card">

<h3>ตะกร้า</h3>

<div id="cartList"></div>

<h3 id="total">รวม: 0 บาท</h3>

<button onclick="showQR()">ชำระเงิน</button>

</div>


<!-- ADMIN PANEL -->
<div id="adminPanel" class="card hidden">

<h3>เพิ่มสินค้า (Admin)</h3>

<input id="newName" placeholder="ชื่อสินค้า">
<input id="newPrice" placeholder="ราคา">

<button onclick="addProduct()">เพิ่มสินค้า</button>

</div>


<!-- REPORT -->
<div id="reportPanel" class="card hidden">

<h3>รายงาน (Admin)</h3>

<div id="reportText"></div>

<button onclick="exportExcel()">Export Excel</button>

</div>

</div>


<!-- QR -->
<div id="qrCard" class="card hidden">

<div class="qrBox">

<h3>สแกนเพื่อชำระเงิน</h3>

<img src="promptpay.jpg">

<div id="qrTotal" class="payTotal"></div>

<button onclick="confirmPayment()">ชำระเงินเสร็จแล้ว</button>

<button onclick="cancelPayment()">ยกเลิก</button>

</div>

</div>


</div>


<script>

/* ======================
DATABASE
====================== */

let products = JSON.parse(localStorage.getItem("products")) || [
{name:"โค้ก",price:15},
{name:"น้ำ",price:10}
];

let cart = [];

let sales = JSON.parse(localStorage.getItem("sales")) || [];

let role = "";


/* ======================
LOGIN
====================== */

function login(){

let r = document.getElementById("role").value;
let pass = document.getElementById("password").value;

if(r==="admin" && pass!=="9999"){
alert("รหัส admin ผิด");
return;
}

if(r==="cashier" && pass!=="1111"){
alert("รหัส cashier ผิด");
return;
}

role=r;

document.getElementById("loginPage").classList.add("hidden");
document.getElementById("mainPage").classList.remove("hidden");

document.getElementById("userLabel").innerText=r;

if(role==="admin"){
document.getElementById("adminPanel").classList.remove("hidden");
document.getElementById("reportPanel").classList.remove("hidden");
}

renderProducts();
renderCart();
renderReport();

}

function logout(){

location.reload();

}


/* ======================
PRODUCT
====================== */

function renderProducts(){

let box=document.getElementById("productList");

box.innerHTML="";

let search=document.getElementById("search").value.toLowerCase();

products.forEach((p,i)=>{

if(p.name.toLowerCase().includes(search)){

box.innerHTML+=
`<div class="product" onclick="addCart(${i})">
${p.name} - ${p.price} บาท
</div>`;

}

});

}

function addProduct(){

let name=document.getElementById("newName").value;
let price=parseFloat(document.getElementById("newPrice").value);

products.push({name,price});

localStorage.setItem("products",JSON.stringify(products));

renderProducts();

}


/* ======================
CART
====================== */

function addCart(i){

cart.push(products[i]);

renderCart();

}

function renderCart(){

let box=document.getElementById("cartList");

box.innerHTML="";

let total=0;

cart.forEach((p,i)=>{

total+=p.price;

box.innerHTML+=`<div>${p.name} ${p.price}</div>`;

});

document.getElementById("total").innerText="รวม: "+total+" บาท";

}


/* ======================
QR
====================== */

function showQR(){

let total=cart.reduce((a,b)=>a+b.price,0);

if(total===0){
alert("ไม่มีสินค้า");
return;
}

document.getElementById("qrCard").classList.remove("hidden");

document.getElementById("qrTotal").innerText=
"ยอดชำระ: "+total+" บาท";

}

function confirmPayment(){

let total=cart.reduce((a,b)=>a+b.price,0);

sales.push(total);

localStorage.setItem("sales",JSON.stringify(sales));

cart=[];

renderCart();

document.getElementById("qrCard").classList.add("hidden");

renderReport();

alert("สำเร็จ");

}

function cancelPayment(){

document.getElementById("qrCard").classList.add("hidden");

}


/* ======================
REPORT
====================== */

function renderReport(){

if(role!=="admin") return;

let sum=sales.reduce((a,b)=>a+b,0);

document.getElementById("reportText").innerText=
"ยอดขายรวม: "+sum+" บาท";

}

function exportExcel(){

let text="data:text/csv;charset=utf-8,";

sales.forEach(s=>{

text+=s+"\\n";

});

let link=document.createElement("a");

link.href=encodeURI(text);

link.download="sales.csv";

link.click();

}

</script>

</body>
</html>
