<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>MP SHOP POS PRO</title>

<style>
body{font-family:sans-serif;background:#eef2f7;margin:0;padding:20px}
.container{max-width:1300px;margin:auto}
.layout{display:flex;gap:20px}
.left,.right{flex:1;background:white;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
input,select,button{width:100%;padding:8px;margin:5px 0;border-radius:5px;border:1px solid #ccc}
button{background:#007bff;color:white;border:none;cursor:pointer}
button:hover{background:#0056b3}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
.product{border:1px solid #ddd;padding:10px;margin:5px 0;border-radius:5px}
.total{font-size:20px;font-weight:bold;color:green}
.report{background:#f8f9fa;padding:10px;margin-top:10px;border-radius:5px}
.hidden{display:none}
.loginBox{max-width:400px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
</style>
</head>

<body>

<div id="loginPage" class="loginBox">
<h2>üîê Login</h2>
<select id="role">
<option value="admin">Admin</option>
<option value="cashier">Cashier</option>
</select>
<input type="password" id="password" placeholder="Password">
<button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<div id="mainPage" class="hidden">
<div class="container">
<h1>üõí MP SHOP POS PRO</h1>

<div class="layout">

<div class="left">

<h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</h2>

<div id="adminSection">

<input id="pname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
<input id="price" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢">
<input id="cost" type="number" placeholder="‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô">
<input id="pstock" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πä‡∏≠‡∏Å">

<button onclick="addProduct()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>

</div>

<h2>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2>
<input id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="renderProducts()">

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
<div id="productList"></div>

</div>

<div class="right">

<h2>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</h2>

<table>
<thead>
<tr>
<th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
<th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
<th>‡∏•‡∏ö</th>
</tr>
</thead>
<tbody id="cart"></tbody>
</table>

<br>
<div class="total">
‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó
</div>

<br>
<button onclick="checkout()">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>

<h2>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>

<div class="report">
‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢: <span id="salesTotal">0</span> ‡∏ö‡∏≤‡∏ó<br>
‡∏Å‡∏≥‡πÑ‡∏£: <span id="profitTotal">0</span> ‡∏ö‡∏≤‡∏ó<br>
‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢: <span id="qtyTotal">0</span>
</div>

<button onclick="exportCSV()">Export Excel (CSV)</button>

</div>
</div>
</div>
</div>

<script>

let currentRole = "";
let products = JSON.parse(localStorage.getItem("products")) || [];
let sales = JSON.parse(localStorage.getItem("sales")) || [];
let cart = [];

function saveData(){
localStorage.setItem("products", JSON.stringify(products));
localStorage.setItem("sales", JSON.stringify(sales));
}

function login(){
let role=document.getElementById("role").value;
let pass=document.getElementById("password").value;

if(role==="admin" && pass==="1234"){
currentRole="admin";
}
else if(role==="cashier" && pass==="0000"){
currentRole="cashier";
}
else{
alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î");
return;
}

document.getElementById("loginPage").classList.add("hidden");
document.getElementById("mainPage").classList.remove("hidden");

if(currentRole==="cashier"){
document.getElementById("adminSection").style.display="none";
}

renderProducts();
updateReport();
}

function addProduct(){
let name=pname.value;
let price=parseFloat(document.getElementById("price").value);
let cost=parseFloat(document.getElementById("cost").value);
let stock=parseInt(document.getElementById("pstock").value);

if(!name||!price||!cost||!stock){
alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
return;
}

products.push({name,price,cost,stock});
saveData();
renderProducts();
pname.value="";
price.value="";
cost.value="";
pstock.value="";
}

function renderProducts(){
let search=document.getElementById("search").value.toLowerCase();
let list=document.getElementById("productList");
list.innerHTML="";

products
.filter(p=>p.name.toLowerCase().includes(search))
.forEach((p,i)=>{
let div=document.createElement("div");
div.className="product";
div.innerHTML=`
<b>${p.name}</b><br>
‡∏£‡∏≤‡∏Ñ‡∏≤: ${p.price} ‡∏ö‡∏≤‡∏ó<br>
‡∏™‡∏ï‡πä‡∏≠‡∏Å: ${p.stock}<br>
<button onclick="addToCart(${i})">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
${currentRole==="admin" ? `<button onclick="deleteProduct(${i})">‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>`:""}
`;
list.appendChild(div);
});
}

function deleteProduct(i){
if(confirm("‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?")){
products.splice(i,1);
saveData();
renderProducts();
}
}

function addToCart(i){
if(products[i].stock<=0){
alert("‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î");
return;
}
products[i].stock--;
cart.push(products[i]);
saveData();
renderProducts();
renderCart();
}

function renderCart(){
let tbody=document.getElementById("cart");
tbody.innerHTML="";
let total=0;

cart.forEach((item,index)=>{
total+=item.price;
tbody.innerHTML+=`
<tr>
<td>${item.name}</td>
<td>${item.price}</td>
<td><button onclick="removeCart(${index})">X</button></td>
</tr>
`;
});

document.getElementById("total").innerText=total;
}

function removeCart(i){
cart.splice(i,1);
renderCart();
}

function checkout(){
if(cart.length===0){alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");return;}

let now=new Date().toLocaleDateString();

cart.forEach(item=>{
sales.push({
date:now,
name:item.name,
price:item.price,
cost:item.cost
});
});

saveData();
cart=[];
renderCart();
updateReport();
alert("‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
}

function updateReport(){
let today=new Date().toLocaleDateString();

let todaySales=sales.filter(s=>s.date===today);

let total=0;
let profit=0;
let qty=todaySales.length;

todaySales.forEach(s=>{
total+=s.price;
profit+=s.price-s.cost;
});

document.getElementById("salesTotal").innerText=total;
document.getElementById("profitTotal").innerText=profit;
document.getElementById("qtyTotal").innerText=qty;
}

function exportCSV(){
let csv="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤,‡∏£‡∏≤‡∏Ñ‡∏≤,‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô\n";
sales.forEach(s=>{
csv+=`${s.date},${s.name},${s.price},${s.cost}\n`;
});

let blob=new Blob([csv],{type:"text/csv"});
let url=URL.createObjectURL(blob);
let a=document.createElement("a");
a.href=url;
a.download="sales-report.csv";
a.click();
}

</script>

</body>
</html>
